rules:
  # ============================================================================
  # SUPABASE CREDENTIAL DETECTION
  # ============================================================================

  - id: supabase-anon-key-exposed
    pattern-regex: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+'
    message: |
      Supabase anon key hardcoded in source code.

      Risk: While anon keys are designed to be public, hardcoding them in source code
      means they will be exposed in version control, making it harder to rotate keys
      and potentially exposing them to attackers who can use them to exhaust your
      Supabase quota or perform unauthorized operations.

      Fix: Move to environment variables:
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
        const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!

      This key appears to be a JWT token starting with the Supabase header.
    severity: WARNING
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "Supabase Credentials"

  - id: supabase-url-hardcoded
    pattern-regex: 'https://[a-z0-9]+\.supabase\.co'
    message: |
      Supabase project URL hardcoded in source code.

      Risk: Exposes your Supabase project identifier in version control,
      making it easier for attackers to target your specific project.

      Fix: Move to environment variables:
        const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!

      Found Supabase URL in code.
    severity: INFO
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-200: Exposure of Sensitive Information"
      confidence: HIGH

  # ============================================================================
  # GENERAL API KEY DETECTION (TypeScript/JavaScript)
  # ============================================================================

  - id: typescript-hardcoded-api-key
    patterns:
      - pattern-either:
          - pattern: const $VAR = "sk-..."
          - pattern: const $VAR = "pk_live_..."
          - pattern: const $VAR = "sk_live_..."
          - pattern: const $VAR = "pk_test_..."
          - pattern: const $VAR = "sk_test_..."
      - pattern-not: const $VAR = "sk-YOUR-KEY"
      - pattern-not: const $VAR = "sk-PLACEHOLDER"
    message: |
      Hardcoded API key detected in TypeScript/JavaScript code.

      Risk: API keys in source code are exposed in version control and can be
      extracted by attackers to access your services, potentially causing
      financial damage or data breaches.

      Fix: Use environment variables:
        const apiKey = process.env.API_KEY!
        const apiKey = import.meta.env.VITE_API_KEY  // Vite
        const apiKey = process.env.NEXT_PUBLIC_API_KEY  // Next.js
    severity: ERROR
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH

  # ============================================================================
  # OPENAI API KEY DETECTION
  # ============================================================================

  - id: openai-api-key-exposed
    pattern-regex: 'sk-[a-zA-Z0-9]{20,}'
    message: |
      OpenAI API key detected in source code!

      Risk: Exposed OpenAI keys allow attackers to make API calls on your behalf,
      potentially incurring significant costs (GPT-4 costs $30-$120 per million tokens).

      Fix:
      1. IMMEDIATELY regenerate your OpenAI API key at platform.openai.com
      2. Move to environment variables:
         const openaiKey = process.env.OPENAI_API_KEY!
      3. Use server-side API routes to protect keys from client exposure
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "OpenAI API Key"

  # ============================================================================
  # STRIPE API KEY DETECTION
  # ============================================================================

  - id: stripe-secret-key-exposed
    pattern-regex: 'sk_(live|test)_[a-zA-Z0-9]{24,}'
    message: |
      CRITICAL: Stripe secret key detected!

      Risk: Stripe secret keys grant full access to your Stripe account, allowing
      attackers to create charges, refunds, and access customer payment information.

      Fix:
      1. IMMEDIATELY roll your Stripe API key in Stripe dashboard
      2. Move to environment variables (server-side ONLY):
         const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!)
      3. NEVER expose secret keys to client-side code
      4. Use publishable keys (pk_) for client-side operations
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "Stripe Secret Key"

  # ============================================================================
  # AWS CREDENTIALS DETECTION
  # ============================================================================

  - id: aws-access-key-exposed
    pattern-regex: 'AKIA[0-9A-Z]{16}'
    message: |
      CRITICAL: AWS Access Key ID detected!

      Risk: Exposed AWS credentials allow attackers to access your AWS resources,
      potentially leading to data breaches, resource hijacking, or massive bills
      from cryptocurrency mining.

      Fix:
      1. IMMEDIATELY disable this access key in AWS IAM console
      2. Review CloudTrail logs for unauthorized access
      3. Use environment variables or AWS credential files
      4. Consider using IAM roles instead of access keys
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "AWS Credentials"

  # ============================================================================
  # GITHUB PERSONAL ACCESS TOKENS
  # ============================================================================

  - id: github-token-exposed
    pattern-regex: 'gh[ps]_[a-zA-Z0-9]{36,}'
    message: |
      CRITICAL: GitHub Personal Access Token detected!

      Risk: Exposed GitHub tokens allow access to your repositories,
      including private code, secrets, and ability to make commits.

      Fix:
      1. IMMEDIATELY revoke this token at github.com/settings/tokens
      2. Review repository access logs for unauthorized activity
      3. Use environment variables:
         const githubToken = process.env.GITHUB_TOKEN!
      4. Use fine-grained tokens with minimal permissions
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "GitHub Token"

  # ============================================================================
  # GENERIC PASSWORD DETECTION
  # ============================================================================

  - id: typescript-hardcoded-password
    patterns:
      - pattern-either:
          - pattern: |
              const password = "..."
          - pattern: |
              const PASSWORD = "..."
          - pattern: |
              password: "..."
      - pattern-not: const password = ""
      - pattern-not: const password = "password"
      - pattern-not: const PASSWORD = "YOUR_PASSWORD"
    message: |
      Hardcoded password detected in TypeScript/JavaScript code.

      Risk: Passwords in source code are exposed to anyone with access to
      the repository, including past commits in git history.

      Fix: Use environment variables:
        const password = process.env.PASSWORD!
    severity: ERROR
    languages: [javascript, typescript]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: MEDIUM

  # ============================================================================
  # SLACK/DISCORD WEBHOOKS
  # ============================================================================

  - id: slack-webhook-exposed
    pattern-regex: 'https://hooks\.slack\.com/services/[A-Za-z0-9/]+'
    message: |
      Slack webhook URL detected in source code.

      Risk: Exposed webhook URLs allow anyone to send messages to your Slack
      workspace, potentially for spam or social engineering attacks.

      Fix:
      1. Regenerate webhook URL in Slack settings
      2. Move to environment variables:
         const webhookUrl = process.env.SLACK_WEBHOOK_URL!
    severity: WARNING
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-200: Exposure of Sensitive Information"
      confidence: HIGH

  - id: discord-webhook-exposed
    pattern-regex: 'https://discord\.com/api/webhooks/[0-9]+/[A-Za-z0-9_-]+'
    message: |
      Discord webhook URL detected in source code.

      Risk: Exposed webhook URLs allow anyone to send messages to your Discord
      server, potentially for spam or phishing attacks.

      Fix:
      1. Regenerate webhook URL in Discord settings
      2. Move to environment variables:
         const webhookUrl = process.env.DISCORD_WEBHOOK_URL!
    severity: WARNING
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-200: Exposure of Sensitive Information"
      confidence: HIGH

  # ============================================================================
  # DATABASE CONNECTION STRINGS
  # ============================================================================

  - id: postgres-connection-string-exposed
    pattern-regex: 'postgres(ql)?://[^:]+:[^@]+@[^/]+'
    message: |
      CRITICAL: PostgreSQL connection string with credentials detected!

      Risk: Exposed database credentials allow direct access to your database,
      enabling attackers to read, modify, or delete all data.

      Fix:
      1. IMMEDIATELY change your database password
      2. Move to environment variables:
         const databaseUrl = process.env.DATABASE_URL!
      3. Use connection pooling and least-privilege database users
      4. Enable database audit logging
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "Database Credentials"

  - id: mongodb-connection-string-exposed
    pattern-regex: 'mongodb(\+srv)?://[^:]+:[^@]+@'
    message: |
      CRITICAL: MongoDB connection string with credentials detected!

      Risk: Exposed database credentials allow direct access to your database.

      Fix:
      1. IMMEDIATELY change your database password
      2. Move to environment variables:
         const mongoUri = process.env.MONGODB_URI!
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "Database Credentials"

  # ============================================================================
  # PRIVATE KEYS
  # ============================================================================

  - id: private-key-exposed
    pattern-regex: '-----BEGIN (RSA |EC |OPENSSH )?PRIVATE KEY-----'
    message: |
      CRITICAL: Private key detected in source code!

      Risk: Exposed private keys allow attackers to impersonate services,
      decrypt sensitive data, or gain unauthorized access to systems.

      Fix:
      1. IMMEDIATELY rotate this key
      2. Review access logs for unauthorized usage
      3. Store keys in secure key management systems (AWS KMS, HashiCorp Vault)
      4. Never commit keys to version control
    severity: ERROR
    languages: [javascript, typescript, python]
    metadata:
      category: security
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
      subcategory: "Private Key"
